# File upload & download

이 프로젝트는 파일 업로드 다운로드의 기능을 정리하는 프로젝트다. 기본적인 upload 와 download 그리고 Secure 등등을 정리를 하고 있다.

# 1. Secure (보안)

파일 업로드를 하는 서비스가 있다. 그런데 누군가 악의적인 목적으로 파일에 바이러스를 심어서 업로드를 하려고 한다. 어떻게 처리를 해야할까? 바이러스를 체크 해야하나? 규악을 지정해서 특정파일만 올리도록 해야할까? 어떻게 하면 악의적인 파일을 막을지 한번 생각해보자.

## 1.1 Policy (규약)

악의적인 파일을 서버에 올릴 경우 해당 서버는 악의 적인 파일을 감지하거나 해당 파일을 못올리게 하는 기능이 있어야 한다. 그렇지 않다면 서버가 망가질 수도 있으니까 말이다. 예를들어 이상한 파일이 올라가서 우리 서버의 파일을 모두 변조 해버렷다. 그럼 망하겟지. 아무튼 정책을 세워보자.

### 1.1.2 Constain File Extention

파일의 확장자를 exe, sh등등 실행파일이 아닌 꼭 사용하기 위한 파일 확장자만 결정한다.

### 1.1.3 Scan Repository And Scan Virus

파일 자체를 실제 저장될 내부 서버가 아닌 Virus가 걸리면 안되겟지만 그나마 좀 덜 위험한 가상서버에 업로드를 한후 Virus Scan Tool이나 백신을 통해서 검증을 한다. Java에서 사용할 만한 백신이나 툴은 다음장에 설명을 해놓았다.

아무튼 이런 가상 서버에 파일을 올려놓고 바이러스를 스캔하고 이상이 없을 경우 실제 내부서버에 FTP를 통해서 업로드 하거나 아니면 별도 로직을 태워서 업로드를 하는 규약을 만든다. 하지만 Virus를 스캔후 당연히 사용자에게 공지를 해줘야 한다.

## 1.2 Application

### 1.2.1 Check Virus Component With Java

Policy를 통해서 어느정도는 보안을 할 수 있다고 생각하지만 우리가 예상치 못하는 상황이 발생 할 수 있습니다. 그렇기 때문에 실제 올라가는 File을 TCP/IP 단계의 전송에서 검증한다거나 업로드가 완료된 파일 자체를 검증하는 서비스가 필요합니다.

그렇기 때문에 실제 파일과 패킷 자체를 분석할 수 있는 도구들을 많은 곳에서 개발하고 제공하고 있습니다.

#### 1.2.1.1 ClamAV (Clam AntiVirus)

시스코 시스템즈에서 지원하는 오픈소스로써 바이러스부터 시작해 수많은 종류의 악성 소프트웨어를 찾아낼 수 있다. 주된 목적가운데 하나는 전자 메일 바이러스 검사기의 역할을 하면서 메일서버에 이용하는 것이다. 이것은 유닉스부터 시작해서 리눅스, 윈도우, 솔라리스 등등 많은 OS를 지원한다. 그리고 공짜다.

하지만 백신이라고 해서 해당 파일의 치료기능은 없다, 단지 삭제/격리만 가능할뿐...

Clamav의 데몬 서버를 실행하고 해당 데몬서버에 클라이언트를 붙여서 테스트하는 방식이다. 이런 클라이언트를 쉽게 개발할 수 있도록 여러 Git Project들이 존재한다.

주소 : https://www.clamav.net/

#### 1.2.1.2 VirusTotal (by Google)

바이러스 방지와 URL, Domain Black List 서비스등등을 제공해주는 서비스다. 비상업적인 목적에서 무료로 제공을 해주는데 프리미엄 서비스등등도 있다. 알약, Ad-Aware, AhnLab-V3등등 여러 60개정도되는 엔진에서 검색하고 해당 파일에 문제가 없는지 알려줍니다. 또한 파일의 세부 정보도 제공합니다.

아무튼 C부터 시작해서 Delphi, Elixir, Erlang, Go, Java등등의 많은 언어기반 API를 제공해줍니다. 또한 많은 VirusTotal회원들이 각각의 언어기반에 사용하기 편한 라이브러리를 만들어서 배포를 하고 있습니다.

주소 : https://www.virustotal.com/#/home/upload (공식 사이트)
주소 : https://support.virustotal.com/hc/en-us/articles/115004581309-API-2-0-Libraries-and-Scripts (Libray 사이트)

### 1.2.2 ClamAV, VirusTotal 차이점

둘의 차이점이라면 ClamAv는 바이러스 백신이고 VirusTotal은 백신보다는 스캐너 종류라고 할 수 있다. ClamAv가 백신이라지만 치료기능은 없다.

바이러스 검출률을 본다면 ClamAV보단 VirusTotal에 손을 들어주고 싶다. 왜냐하면 ClamAv는 자체 바이러스 엔진을 쓴다고 하지만 VirusTotal은 60개의 바이러스 엔진을 사용하기 때문이다.

사용방법으로 본다면 VirusTotal의 손을 또 들어주고 싶다. ClamAv는 별도 설치를 해주고 데몬을 돌리고 데몬과 서비스간의 통신을 해야하는데 VirusTotal을 인증키와 함께 해당 함수 하나만 호출하면 되기 때문이다.

안정성도 VirusTotal의 손을 들어주고 싶다. ClamAV는 우리가 관리해야한다. 만약 ClamAV의 데몬이 잘못되거나 해당 서버가 중지된다면 우리의 바이러스 탐지 로직은 무용지물이 될것이다. 하지만 TotalVirus는 자기들이 자체 제공을 하고 있을 뿐만 아니라 프리미엄서비스에는 무언가 기되되는 것이 있을 것이라 생각이 든다.

비용으로는 ClamAV의 손을 들어주고 싶다. ClamAV는 그냥 무료다. 하지만 VirusTotal은 최초 공개 API를 통해서 제공하지만 프리미엄이 아닐경우 제한이 되는 것이 있을 것이다.




